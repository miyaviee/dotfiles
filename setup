#!/bin/bash

git fetch -p
git merge origin/master

# vim-plug
test -e ~/.vim/autoload/plug.vim || curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
  https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim

test -d ~/.zplug || git clone https://github.com/zplug/zplug ~/.zplug

# filetype conf
for name in `ls -a`; do
  if [ -d ${name} ]; then
    test ${name:0:1} = '.' && continue

    ln -fs `pwd`/${name} ~/.vim/${name}
    continue
  fi

  test ${name:0:1} = '.' && ln -fs `pwd`/${name} ~/${name}
done

vim +:PlugInstall +:q +:PlugClean +:q +:q
vim install.go +:GoInstallBinaries +:q

test -z "$(which flake8)" && pip3 install flake8

if [ ! -d ~/.pip ]; then
  mkdir ~/.pip
  cat <<EOS > ~/.pip/pip.conf
[list]
format=columns
EOS
fi

# del dead link
for link in ~/.*; do
  test -L $link || continue
  test -e "$(readlink $link)" && continue
  unlink $link
done
