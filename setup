#!/bin/bash

git fetch -p
git merge origin/master

# neobundle
if [ ! -e ~/.vim/autoload/plug.vim ]; then
  curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
  https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
fi

if [ ! -d ~/.zplug ]; then
  git clone https://github.com/zplug/zplug ~/.zplug
fi

# filetype conf
for name in `ls -a`
do
  if [ -d ${name} ]; then
    if [ ${name:0:1} == '.' ]; then
      continue
    fi
    mkdir -p ~/.vim/${name}
    for file in ${name}/*
    do
      ln -fs `pwd`/${file} ~/.vim/${file}
    done
    continue;
  fi
  if [ ${name:0:1} == '.' ]; then
    ln -fs `pwd`/${name} ~/${name}
  fi
done

vim +:PlugInstall +:q +:PlugClean +:q +:q
vim install.go +:GoInstallBinaries +:q

if [ -z "$(which flake8)" ]; then
  pip3 install flake8
fi
if [ ! -d ~/.pip ]; then
  mkdir ~/.pip
  cat <<EOS > ~/.pip/pip.conf
  [list]
  format=columns
EOS
fi

# del dead link
for link in ~/.*
do
  if [ ! -L $link ]; then
    continue;
  fi
  if [ -e "`readlink $link`" ]; then
    continue;
  fi

  unlink $link
done
