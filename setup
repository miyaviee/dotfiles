#!/bin/sh

git fetch -p
git merge origin/master

# vim-plug
test -e ~/.vim/autoload/plug.vim || curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
  https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim

test -e ~/.zplug/init.zsh || git clone https://github.com/zplug/zplug ~/.zplug

# filetype conf
for name in `ls -a`; do
  if [ -d ${name} ]; then
    test ${name:0:1} = '.' && continue
    test -L ~/.vim/${name} && continue

    rm -rf ~/.vim/${name}
    ln -fs `pwd`/${name} ~/.vim/${name}
    continue
  fi

  test ${name:0:1} = '.' && ln -fs `pwd`/${name} ~/${name}
done

test -L ~/.config/nvim || ln -fs ~/.vim ~/.config/nvim
test -L ~/.config/nvim/init.vim || ln -fs ~/.vimrc ~/.config/nvim/init.vim

nvim +:PlugInstall +:q +:PlugClean +:q +:q

if [ ! -d ~/.pip ]; then
  mkdir ~/.pip
  cat <<EOS > ~/.pip/pip.conf
[list]
format=columns
EOS
fi

test -e ~/.config || mkdir ~/.config
for name in `ls -a .config`; do
  test ${name:0:1} = '.' && continue
  test -L ~/.config/${name} && continue

  rm -rf ~/.config/${name}
  ln -fs `pwd`/.config/${name} ~/.config/${name}
done

test -L ~/.git_tmp || ln -fs `pwd`/.git_tmp ~/.git_tmp
test -z "$(git config --global --get init.templatedir)" && git config --global init.templatedir ~/.git_tmp

# del dead link
for link in ~/.*; do
  test -L $link || continue
  test -e "$(readlink $link)" && continue
  unlink $link
done
