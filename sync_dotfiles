#!/bin/bash

# clear dir link
for name in $(find . \( -type f -o -name '.git' \) -prune -o -print); do
  [[ -L ~/${name} ]] && unlink ~/${name}
done

# clear dead link
for name in $(find -L ~ -maxdepth 1 -type l); do
  unlink ${name}
done

for name in .config .pip .ctags.d .git_template; do
  [[ -e ~/${name} ]] || continue
  for subName in $(find -L ~/${name} -type l); do
    unlink ${subName}
  done
done

# root dotfiles
for name in .*; do
  if [[ ${name} =~ \.+(git(ignore)?|tags|[A-Z].*)?$ ]]; then
    continue
  fi
  if [[ -f ${name} ]]; then
    [[ -e ~/${name} ]] || ln -s $(pwd)/${name} ~/${name}
    continue
  fi
  for subName in $(find ${name} -type f); do
    mkdir -p ~/$(dirname ${subName})
    [[ -e ~/${subName} ]] || ln -s $(pwd)/${subName} ~/${subName}
  done
done

[[ -e ~/.config/mise/config.toml ]] || mkdir -p ~/.config/mise && cp mise.toml ~/.config/mise/config.toml

# vim
[[ -e ~/.vimrc ]] || ln -s ~/.config/nvim/init.vim ~/.vimrc
[[ -e ~/.vim ]] || ln -s ~/.config/nvim ~/.vim
