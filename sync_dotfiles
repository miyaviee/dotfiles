#!/bin/bash

# root dotfiles
for name in .*; do
  if [[ ${name} =~ \.+(config|local|git(ignore)?|tags|eslintrc\..*|[A-Z].*)?$ ]]; then
    continue
  fi
  [[ -e ~/${name} ]] || ln -s $(pwd)/${name} ~/${name}
done

mkdir -p ~/.config
for name in $(find .config -maxdepth 1 -type f); do
  [[ -e ~/${name} ]] || ln -s $(pwd)/${name} ~/${name}
done

for name in $(find .config -maxdepth 1 -type d); do
  mkdir -p ~/${name}
  for subName in $(find ${name} -maxdepth 1); do
    [[ -e ~/${subName} ]] || ln -s $(pwd)/${subName} ~/${subName}
  done
done

[[ -e ~/.config/mise/config.toml ]] || mkdir -p ~/.config/mise && cp mise.toml ~/.config/mise/config.toml

# vim
[[ -e ~/.vimrc ]] || ln -s ~/.config/nvim/init.vim ~/.vimrc
[[ -e ~/.vim ]] || ln -s ~/.config/nvim ~/.vim

# clear link
for name in $(find -L ~ -maxdepth 1 -type l); do
  unlink ${name}
done

for name in $(find -L ~/.config -type l); do
  unlink ${name}
done
