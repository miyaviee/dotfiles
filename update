#!/bin/bash

set -e

git pull -p
./sync_dotfiles

BREW_UPGRADE_OPT=""
if [ $(date +"%d") == "01" ]; then
  BREW_UPGRADE_OPT="--fetch-HEAD"
fi

type brew > /dev/null 2>&1 && brew upgrade ${BREW_UPGRADE_OPT}; brew cleanup

asdf update
asdf install

$EDITOR +PlugUpgrade +PlugUpdate +PlugClean +qa
[[ $EDITOR = 'nvim' ]] && $EDITOR +UpdateRemotePlugins +qa

gotools=(
  github.com/cweill/gotests/...
  mvdan.cc/gofumpt
  github.com/segmentio/golines
  github.com/ChimeraCoder/gojson/gojson
)

for repo in ${gotools[@]}; do
  go install ${repo}@latest
done

pushd ~/.zplug && git pull -p && popd
zsh -c 'source ~/.zplug/init.zsh; zplug update'
